<ng-container *ngrxLet="table$ as table">
  <div class="container">
    <table>
      <!--Table header-->
      <thead>
      <tr>
        <!--Empty top left header cell-->
        <th></th>
        <!--Column header cells-->
        @for (col of table.head; track col; let c = $index) {
          <th
            (click)="clickHeader(c)"
            (contextmenu)="showTheadMenu($event, c)"
            (mouseenter)="activeTheadIndex = c"
            (mouseleave)="activeTheadIndex = -1"
          >
            {{ col }}
          </th>
        }
      </tr>
      </thead>
      <!--Table body-->
      <tbody style="overflow-y: auto">
      <!--Table rows-->
        @for (row of table.body; track row; let r = $index) {
          <tr>
            <!--Row header cell-->
            <th
              (click)="clickRow(r)"
              (contextmenu)="showTbodyMenu($event, r)"
              (mouseenter)="activeTbodyIndex = r"
              (mouseleave)="activeTbodyIndex = -1"
            >
              {{ r + 1 }}
            </th>
            <!--Table data cell-->
            @for (cell of row; track cell.id; let c = $index) {
              <td
                [id]="cell.id"
                [class.focus]="cell === activatedCell"
                [class.sel]="range?.includes(cell.row, cell.col)"
                nssContentEditable
                [content]="cell.value"
                (contentChange)="updateValue(table, cell, $event)"
                (focus)="focus($event)"
                (blur)="blur($event)"
                (mousedown)="cellMouseUp($event, cell)"
                [attr.contenteditable]="cell.editable"
              ></td>
            }
          </tr>
        }
        <!--New data row, click to increase row size-->
        @if (table.canInsertRows) {
          <tr>
            <th>*</th>
            @for (_ of [].constructor(table.colCount); track $index; let i = $index) {
              <td
                (click)="newRow(i)"
              ></td>
            }
          </tr>
        }
      </tbody>
    </table>
  </div>
  <!--Column header context menu-->
  <ngx-context-menu #theadMenu (closed)="activeTheadIndex = -1">
    <ngx-context-menu-item
      [label]="i18n.INSERT_COLUMN_LEFT"
      (click)="table.insertColumn($event)"
    >
    </ngx-context-menu-item>
    <ngx-context-menu-item
      [label]="i18n.INSERT_COLUMN_RIGHT"
      (click)="table.insertColumn($event + 1)"
    >
    </ngx-context-menu-item>
    <ngx-context-menu-item [divider]="true"></ngx-context-menu-item>
    <ngx-context-menu-item
      [label]="i18n.DELETE_COLUMN"
      [disabled]="table.colCount <= 1"
      (click)="table.deleteColumn($event)"
    >
    </ngx-context-menu-item>
  </ngx-context-menu>

  <!--Row header context menu-->
  <ngx-context-menu #tbodyMenu (closed)="activeTbodyIndex = -1">
    <ngx-context-menu-item
      [label]="i18n.INSERT_ROW_ABOVE"
      (click)="table.insertRow($event)"
    >
    </ngx-context-menu-item>
    <ngx-context-menu-item
      [label]="i18n.INSERT_ROW_BELOW"
      (click)="table.insertRow($event + 1)"
    >
    </ngx-context-menu-item>
    <ngx-context-menu-item [divider]="true"></ngx-context-menu-item>
    <ngx-context-menu-item
      [label]="i18n.DELETE_ROW"
      [disabled]="table.rowCount <= 1"
      (click)="table.deleteRow($event)"
    >
    </ngx-context-menu-item>
  </ngx-context-menu>
</ng-container>
